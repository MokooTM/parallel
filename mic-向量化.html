
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>向量化 · parallel</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        <meta name="author" content="zhangjikai">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism-base16-ateliersulphurpool.light.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="mic-异步计算和传输.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="http://zhangjikai.com" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.1.</b>
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="mpi.html">
            
                <a href="mpi.html">
            
                    
                        <b>1.2.</b>
                    
                    MPI
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="mpi-helloworld.html">
            
                <a href="mpi-helloworld.html">
            
                    
                        <b>1.2.1.</b>
                    
                    MPI-HelloWorld
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="基础函数.html">
            
                <a href="基础函数.html">
            
                    
                        <b>1.2.2.</b>
                    
                    基础函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="通信类别.html">
            
                <a href="通信类别.html">
            
                    
                        <b>1.2.3.</b>
                    
                    通信类别
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="通信模式.html">
            
                <a href="通信模式.html">
            
                    
                        <b>1.2.4.</b>
                    
                    通信模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="编程模式.html">
            
                <a href="编程模式.html">
            
                    
                        <b>1.2.5.</b>
                    
                    编程模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="非阻塞通信.html">
            
                <a href="非阻塞通信.html">
            
                    
                        <b>1.2.6.</b>
                    
                    非阻塞通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="重复非阻塞通信.html">
            
                <a href="重复非阻塞通信.html">
            
                    
                        <b>1.2.7.</b>
                    
                    重复非阻塞通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="组通信.html">
            
                <a href="组通信.html">
            
                    
                        <b>1.2.8.</b>
                    
                    组通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="数据处理.html">
            
                <a href="数据处理.html">
            
                    
                        <b>1.2.9.</b>
                    
                    数据类型
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="openmp.html">
            
                <a href="openmp.html">
            
                    
                        <b>1.3.</b>
                    
                    OpenMP
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="openmp-基本使用.html">
            
                <a href="openmp-基本使用.html">
            
                    
                        <b>1.3.1.</b>
                    
                    OpenMP 基本使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="编译制导指令.html">
            
                <a href="编译制导指令.html">
            
                    
                        <b>1.3.2.</b>
                    
                    编译制导指令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="运行环境交互.html">
            
                <a href="运行环境交互.html">
            
                    
                        <b>1.3.3.</b>
                    
                    运行环境交互
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="更多指令和子句.html">
            
                <a href="更多指令和子句.html">
            
                    
                        <b>1.3.4.</b>
                    
                    更多指令和子句
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="pthread.html">
            
                <a href="pthread.html">
            
                    
                        <b>1.4.</b>
                    
                    Pthreads
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="Pthreads-使用.html">
            
                <a href="Pthreads-使用.html">
            
                    
                        <b>1.4.1.</b>
                    
                    语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="Pipline-模型.html">
            
                <a href="Pipline-模型.html">
            
                    
                        <b>1.4.2.</b>
                    
                    流水线模型
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="mic.html">
            
                <a href="mic.html">
            
                    
                        <b>1.5.</b>
                    
                    MIC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="mic-helloworld.html">
            
                <a href="mic-helloworld.html">
            
                    
                        <b>1.5.1.</b>
                    
                    HelloWorld
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="offload.html">
            
                <a href="offload.html">
            
                    
                        <b>1.5.2.</b>
                    
                    offload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="offload-详解.html">
            
                <a href="offload-详解.html">
            
                    
                        <b>1.5.3.</b>
                    
                    in / out / inout 详细用法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="offload-other.html">
            
                <a href="offload-other.html">
            
                    
                        <b>1.5.4.</b>
                    
                    offload 其他函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="mic-共享虚拟内存模式.html">
            
                <a href="mic-共享虚拟内存模式.html">
            
                    
                        <b>1.5.5.</b>
                    
                    共享虚拟内存模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="mic-异步计算和传输.html">
            
                <a href="mic-异步计算和传输.html">
            
                    
                        <b>1.5.6.</b>
                    
                    异步计算和传输
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.7" data-path="mic-向量化.html">
            
                <a href="mic-向量化.html">
            
                    
                        <b>1.5.7.</b>
                    
                    向量化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >向量化</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-anchor"></i><ul><li><a href="#&#x5411;&#x91CF;&#x5316;">&#x5411;&#x91CF;&#x5316;</a></li><ul><li><a href="#&#x524D;&#x8A00;">&#x524D;&#x8A00;</a></li><li><a href="#&#x6570;&#x636E;&#x7C7B;&#x578B;">&#x6570;&#x636E;&#x7C7B;&#x578B;</a></li><li><a href="#&#x5411;&#x91CF;&#x5316;&#x51FD;&#x6570;intrinsics">&#x5411;&#x91CF;&#x5316;&#x51FD;&#x6570;(Intrinsics)</a></li><ul><li><a href="#&#x7B97;&#x672F;&#x8FD0;&#x7B97;">&#x7B97;&#x672F;&#x8FD0;&#x7B97;</a></li><li><a href="#with-mask">With Mask</a></li><li><a href="#bitwise&#x8FD0;&#x7B97;">Bitwise&#x8FD0;&#x7B97;</a></li><li><a href="#&#x79FB;&#x4F4D;&#x64CD;&#x4F5C;">&#x79FB;&#x4F4D;&#x64CD;&#x4F5C;</a></li><li><a href="#mm512alignrepi32">_mm512_alignr_epi32</a></li></ul></ul></ul></div><a href="#&#x5411;&#x91CF;&#x5316;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="&#x5411;&#x91CF;&#x5316;"><a name="&#x5411;&#x91CF;&#x5316;" class="anchor-navigation-ex-anchor" href="#&#x5411;&#x91CF;&#x5316;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5411;&#x91CF;&#x5316;</h1>
<!-- toc -->
<ul>
<li><a href="#&#x524D;&#x8A00;">&#x524D;&#x8A00;</a></li>
<li><a href="#&#x6570;&#x636E;&#x7C7B;&#x578B;">&#x6570;&#x636E;&#x7C7B;&#x578B;</a></li>
<li><a href="#&#x5411;&#x91CF;&#x5316;&#x51FD;&#x6570;intrinsics">&#x5411;&#x91CF;&#x5316;&#x51FD;&#x6570;(Intrinsics)</a><ul>
<li><a href="#&#x7B97;&#x672F;&#x8FD0;&#x7B97;">&#x7B97;&#x672F;&#x8FD0;&#x7B97;</a></li>
<li><a href="#with-mask">With Mask</a></li>
<li><a href="#bitwise&#x8FD0;&#x7B97;">Bitwise&#x8FD0;&#x7B97;</a></li>
<li><a href="#&#x79FB;&#x4F4D;&#x64CD;&#x4F5C;">&#x79FB;&#x4F4D;&#x64CD;&#x4F5C;</a></li>
<li><a href="#_mm512_alignr_epi32">_mm512_alignr_epi32</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h2 id="&#x524D;&#x8A00;"><a name="&#x524D;&#x8A00;" class="anchor-navigation-ex-anchor" href="#&#x524D;&#x8A00;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x524D;&#x8A00;</h2>
<p>&#x5411;&#x91CF;&#x5316;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x5C31;&#x662F;&#x4F7F;&#x7528;SIMD&#x6307;&#x4EE4;, &#x6765;&#x5B9E;&#x73B0;&#x4F7F;&#x7528;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#x540C;&#x65F6;&#x5904;&#x7406;&#x591A;&#x4E2A;&#x6570;&#x636E;, MIC&#x4E2D;&#x5177;&#x6709;32&#x4E2A;&#x957F;&#x5EA6;&#x4E3A;512&#x4F4D;&#x7684;&#x5411;&#x91CF;&#x5904;&#x7406;&#x5355;&#x5143;, &#x6BCF;&#x4E2A;&#x5411;&#x91CF;&#x5904;&#x7406;&#x5355;&#x5143;&#x53EF;&#x4EE5;&#x5904;&#x7406;16&#x4E2A;32&#x4F4D;&#x6216;&#x8005;8&#x4E2A;64&#x4F4D;&#x7684;&#x6570;&#x636E;. &#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;MIC&#x5411;&#x91CF;&#x5316;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x5411;&#x91CF;&#x6307;&#x4EE4;&#x7684;&#x4F5C;&#x7528;.</p>
<h2 id="&#x6570;&#x636E;&#x7C7B;&#x578B;"><a name="&#x6570;&#x636E;&#x7C7B;&#x578B;" class="anchor-navigation-ex-anchor" href="#&#x6570;&#x636E;&#x7C7B;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6570;&#x636E;&#x7C7B;&#x578B;</h2>
<p>MIC&#x4E2D;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4F5C;&#x4E3A;&#x6267;&#x884C;&#x5411;&#x91CF;&#x51FD;&#x6570;&#x7684;&#x64CD;&#x4F5C;&#x6570;</p>
<pre class="language-"><code class="lang-c">__m512<span class="token punctuation">,</span> __m512i  __m512d
</code></pre>
<p>&#x4E0B;&#x9762;&#x662F;&#x5B83;&#x4EEC;&#x7684;&#x5404;&#x81EA;&#x7684;&#x4F5C;&#x7528;:</p>
<ul>
<li><code>__m512</code> - &#x5904;&#x7406;&#x5355;&#x7CBE;&#x5EA6;&#x5411;&#x91CF;(float32 vector)</li>
<li><code>__m512d</code> - &#x5904;&#x7406;&#x53CC;&#x7CBE;&#x5EA6;&#x5411;&#x91CF;(float64 vector)</li>
<li><code>__m512i</code> - &#x5904;&#x7406;&#x6574;&#x5F62;&#x5411;&#x91CF;, &#x5305;&#x62EC;32&#x4F4D;&#x548C;64&#x4F4D;&#x6574;&#x5F62;(int32/int64)</li>
</ul>
<p>&#x4E0A;&#x9762;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x76F4;&#x63A5;&#x6620;&#x5C04;&#x5230;&#x5411;&#x91CF;&#x5BC4;&#x5B58;&#x5668;&#x4E0A;(vector registers), &#x9664;&#x6B64;&#x4E4B;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x7C7B;&#x578B;__mmask16 - is an unsigned short type associated with the mask register values.
&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>Load Intrinsics</code>(&#x4E3A;&#x5411;&#x91CF;&#x8D4B;&#x503C;) &#x548C; <code>Store Intrinsics</code> (&#x4FDD;&#x5B58;&#x5411;&#x91CF;&#x7684;&#x503C;) &#x5B9E;&#x73B0;&#x5411;&#x91CF;&#x7684;&#x5B58;&#x53D6;. &#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;</p>
<pre class="language-"><code class="lang-c"><span class="token keyword">void</span> <span class="token function">test_load_store</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// &#x4F7F;&#x7528;int32_t&#x548C;int64_t &#x9700;&#x8981;&#x5F15;&#x5165;stdint.h</span>
    int32_t <span class="token operator">*</span>arr_int32<span class="token punctuation">;</span>
    int64_t <span class="token operator">*</span>arr_int64<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// &#x9700;&#x8981;&#x4F7F;&#x7528;_mm_malloc&#x5206;&#x914D;&#x5185;&#x5B58;, &#x5E76;&#x4E14;&#x4EE5;64&#x4F4D;&#x5BF9;&#x9F50;, &#x5426;&#x5219;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x9519;&#x8BEF;</span>
    arr_int32 <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_int64 <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>int64_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr_int32<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
        arr_int64<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> n<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> offload target(mic) inout(arr_int32:length(n)) inout(arr_int64:length(n))</span>
    <span class="token punctuation">{</span>
        __m512i m_32<span class="token punctuation">,</span> m_64<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// &#x5C06;arr_int32 &#x4E2D;0-15&#x4E2A;&#x5143;&#x7D20;&#x52A0;&#x8F7D;&#x5230; m_32 &#x4E2D;</span>
        m_32 <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_int32<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// &#x5C06;arr_int32 &#x4E2D;16-31&#x4E2A;&#x5143;&#x7D20;&#x52A0;&#x8F7D;&#x5230; m_32 &#x4E2D;</span>
        m_32 <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_int32 <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// &#x5C06;arr_int64&#x4E2D;0-7&#x4E2A;&#x5143;&#x7D20;&#x52A0;&#x8F7D;&#x5230; m_64 &#x4E2D;</span>
        m_64 <span class="token operator">=</span> <span class="token function">_mm512_load_epi64</span><span class="token punctuation">(</span>arr_int64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// &#x5C06;arr_int64&#x4E2D;8-15&#x4E2A;&#x5143;&#x7D20;&#x52A0;&#x8F7D;&#x5230; m_64 &#x4E2D;</span>
        m_64 <span class="token operator">=</span> <span class="token function">_mm512_load_epi64</span><span class="token punctuation">(</span>arr_int64 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// &#x5C06;m_32 &#x4E2D;&#x7684;&#x503C;&#x4FDD;&#x5B58;&#x5230;arr_int32 &#x7684;0-15&#x4E2A;&#x5143;&#x7D20;&#x4E2D;</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_int32<span class="token punctuation">,</span> m_32<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// &#x5C06;m_64 &#x4E2D;&#x7684;&#x503C;&#x4FDD;&#x5B58;&#x5230;arr_int32 &#x7684;16-31&#x4E2A;&#x5143;&#x7D20;&#x4E2D;</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_int32 <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">,</span> m_32<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// &#x5C06;m_64 &#x4E2D;&#x7684;&#x503C;&#x4FDD;&#x5B58;&#x5230;arr_int64&#x7684;0-7&#x4E2A;&#x5143;&#x7D20;</span>
        <span class="token function">_mm512_store_epi64</span><span class="token punctuation">(</span>arr_int64<span class="token punctuation">,</span> m_64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// &#x5C06;m_64 &#x4E2D;&#x7684;&#x503C;&#x4FDD;&#x5B58;&#x5230;arr_int64&#x7684;8-15&#x4E2A;&#x5143;&#x7D20;&#x4E2D;</span>
        <span class="token function">_mm512_store_epi64</span><span class="token punctuation">(</span>arr_int64 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">,</span> m_64<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// &#x4F7F;&#x7528;_mm_malloc&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x9700;&#x8981;_mm_free&#x6765;&#x91CA;&#x653E;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_int32<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_int64<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x5411;&#x91CF;&#x5316;&#x51FD;&#x6570;intrinsics"><a name="&#x5411;&#x91CF;&#x5316;&#x51FD;&#x6570;intrinsics" class="anchor-navigation-ex-anchor" href="#&#x5411;&#x91CF;&#x5316;&#x51FD;&#x6570;intrinsics"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5411;&#x91CF;&#x5316;&#x51FD;&#x6570;(Intrinsics)</h2>
<p>&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x8BB0;&#x5F55;&#x4E00;&#x4E9B;&#x7F16;&#x8BD1;&#x5668;&#x63D0;&#x4F9B;&#x7684;&#x5411;&#x91CF;&#x5316;&#x51FD;&#x6570;, &#x5B8C;&#x6574;&#x7684;&#x51FD;&#x6570;&#x96C6;&#x53EF;&#x4EE5;&#x5728;<a href="https://software.intel.com/en-us/node/523386" target="_blank">&#x8FD9;&#x91CC;</a>&#x6216;&#x8005;<a href="http://scc.ustc.edu.cn/zlsc/tc4600/intel/2015.1.133/compiler_c/" target="_blank">&#x8FD9;&#x91CC;</a>&#x67E5;&#x8BE2;</p>
<h3 id="&#x7B97;&#x672F;&#x8FD0;&#x7B97;"><a name="&#x7B97;&#x672F;&#x8FD0;&#x7B97;" class="anchor-navigation-ex-anchor" href="#&#x7B97;&#x672F;&#x8FD0;&#x7B97;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7B97;&#x672F;&#x8FD0;&#x7B97;</h3>
<p>MIC&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x52A0;,&#x51CF;, &#x4E58; &#x4E09;&#x79CD;&#x7B97;&#x672F;&#x8FD0;&#x7B97;&#x51FD;&#x6570;, &#x8FD9;&#x91CC;&#x4EE5;32&#x4F4D;&#x6574;&#x578B;&#x7684;&#x52A0;&#x6CD5;&#x4E3A;&#x4F8B;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;immintrin.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">mic_add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint32_t <span class="token operator">*</span>arr_a<span class="token punctuation">,</span> <span class="token operator">*</span>arr_b<span class="token punctuation">,</span> <span class="token operator">*</span>arr_c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    arr_a <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_b <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_c <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
        arr_b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> n <span class="token operator">+</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> offload target(mic) in(arr_a:length(n)) in(arr_b:length(n)) out(arr_c:length(n))</span>
    <span class="token punctuation">{</span>
        __m512i m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">,</span> m_c<span class="token punctuation">;</span>
        m_a <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_b <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_c <span class="token operator">=</span> <span class="token function">_mm512_add_epi32</span><span class="token punctuation">(</span>m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// &#x51CF;&#x6CD5;</span>
        <span class="token comment" spellcheck="true">//m_c = _mm512_sub_epi32(m_a, m_b);</span>

        <span class="token comment" spellcheck="true">// &#x4E58;&#x6CD5; _mm512_mullo_epi32 &#x4FDD;&#x7559;&#x4E58;&#x6CD5;&#x7ED3;&#x679C;&#x7684;&#x4F4E;32&#x4F4D;, _mm512_mulhi_epi32&#x4FDD;&#x5B58;&#x7ED3;&#x679C;&#x7684;&#x9AD8;32&#x4F4D;</span>
        <span class="token comment" spellcheck="true">// m_c = _mm512_mullo_epi32(m_a, m_b);</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">,</span> m_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;arr_a[%2d] is: %2d \t  arr_b[%2d] is: %2d \t  arr_c[%2d] is : %2d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr_b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr_c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">mic_add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x4E3A;:</p>
<pre class="language-"><code class="lang-html">arr_a[ 0] is:  0       arr_b[ 0] is: 16       arr_c[ 0] is : 16
arr_a[ 1] is:  1       arr_b[ 1] is: 17       arr_c[ 1] is : 18
arr_a[ 2] is:  2       arr_b[ 2] is: 18       arr_c[ 2] is : 20
arr_a[ 3] is:  3       arr_b[ 3] is: 19       arr_c[ 3] is : 22
arr_a[ 4] is:  4       arr_b[ 4] is: 20       arr_c[ 4] is : 24
arr_a[ 5] is:  5       arr_b[ 5] is: 21       arr_c[ 5] is : 26
arr_a[ 6] is:  6       arr_b[ 6] is: 22       arr_c[ 6] is : 28
arr_a[ 7] is:  7       arr_b[ 7] is: 23       arr_c[ 7] is : 30
arr_a[ 8] is:  8       arr_b[ 8] is: 24       arr_c[ 8] is : 32
arr_a[ 9] is:  9       arr_b[ 9] is: 25       arr_c[ 9] is : 34
arr_a[10] is: 10       arr_b[10] is: 26       arr_c[10] is : 36
arr_a[11] is: 11       arr_b[11] is: 27       arr_c[11] is : 38
arr_a[12] is: 12       arr_b[12] is: 28       arr_c[12] is : 40
arr_a[13] is: 13       arr_b[13] is: 29       arr_c[13] is : 42
arr_a[14] is: 14       arr_b[14] is: 30       arr_c[14] is : 44
arr_a[15] is: 15       arr_b[15] is: 31       arr_c[15] is : 46
</code></pre>
<h3 id="with-mask"><a name="with-mask" class="anchor-navigation-ex-anchor" href="#with-mask"><i class="fa fa-link" aria-hidden="true"></i></a>With Mask</h3>
<p>MIC&#x63D0;&#x4F9B;&#x7684;&#x5411;&#x91CF;&#x51FD;&#x6570;&#x4E00;&#x822C;&#x6709;&#x4E24;&#x79CD;&#x5F62;&#x5F0F;</p>
<pre class="language-"><code class="lang-c"><span class="token comment" spellcheck="true">// Without Mask</span>
<span class="token keyword">extern</span> _m512i __cdecl <span class="token function">_mm512_add_epi32</span><span class="token punctuation">(</span>_m512i v2<span class="token punctuation">,</span> _m512i v3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// With Mask</span>
<span class="token keyword">extern</span> _m512i __cdecl <span class="token function">_mm512_mask_add_epi32</span><span class="token punctuation">(</span>_m512i v1_old<span class="token punctuation">,</span> __mmask16 k1<span class="token punctuation">,</span> _m512i v2<span class="token punctuation">,</span> _m512i v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x4E00;&#x79CD;&#x662F;&#x5E26;Mask&#x7684;, &#x4E00;&#x79CD;&#x662F;&#x4E0D;&#x5E26;Mask&#x7684;. &#x5E26;Mask&#x7684;&#x591A;&#x4E86;&#x4E24;&#x4E2A;&#x53C2;&#x6570;: <code>v1_old</code>&#x548C;<code>k1</code>, &#x5176;&#x4E2D;<code>k1</code>&#x662F;<code>__mmask16</code>&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;, &#x5728;&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x77E5;&#x9053;<code>__mmask</code>&#x7C7B;&#x578B;&#x5C31;&#x662F;<code>unsigned short</code>&#x7C7B;&#x578B;, &#x957F;&#x5EA6;&#x4E3A;16&#x4F4D;. &#x5173;&#x4E8E;&#x5E26;mask&#x51FD;&#x6570;&#x7684;&#x89E3;&#x91CA;: &#x5C06;<code>v1</code>&#x7684;16&#x4F4D;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x5230;<code>_m512i</code>&#x7684;16&#x4E2A;&#x6574;&#x578B;&#x4E0A;, &#x5982;&#x679C;<code>k1</code>&#x67D0;&#x4E2A;&#x4F4D;&#x662F;1, &#x5219;&#x5C06;v2&#x548C;v3&#x4E2D;&#x4E0E;&#x8BE5;&#x4F4D;&#x5BF9;&#x5E94;&#x7684;&#x6574;&#x578B;&#x76F8;&#x52A0;, &#x4F5C;&#x4E3A;&#x7ED3;&#x679C;&#x503C;, &#x5982;&#x679C;<code>k1</code>&#x67D0;&#x4E2A;&#x4F4D;&#x4E3A;0, &#x5C31;&#x4F7F;&#x7528;<code>v1_old</code>&#x5411;&#x91CF;&#x4E2D;&#x5BF9;&#x5E94;&#x4F4D;&#x7684;&#x6574;&#x578B;&#x4F5C;&#x4E3A;&#x7ED3;&#x679C;&#x503C;. &#x4F8B;&#x5982;&#x5982;&#x679C;<code>k1</code>&#x7684;&#x7B2C;&#x4E00;&#x4F4D;&#x4E3A;1, &#x90A3;&#x4E48;&#x5C31;&#x5C06;<code>v2</code>&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x548C;<code>v3</code>&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x76F8;&#x52A0;, &#x4F5C;&#x4E3A;&#x7ED3;&#x679C;&#x5411;&#x91CF;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6574;&#x578B;&#x7684;&#x503C;. &#x5982;&#x679C;<code>k1</code>&#x7684;&#x7B2C;&#x4E00;&#x4F4D;&#x662F;0, &#x5C31;&#x5C06;<code>v1_old</code>&#x5411;&#x91CF;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6574;&#x578B;&#x7684;&#x503C;&#x4F5C;&#x4E3A;&#x7ED3;&#x679C;&#x5411;&#x91CF;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;&#x6574;&#x578B;&#x7684;&#x503C;. &#x597D;&#x5427;, &#x8FD8;&#x662F;&#x770B;&#x4E2A;&#x4F8B;&#x5B50;&#x5427;.</p>
<pre class="language-"><code class="lang-c"><span class="token keyword">void</span> <span class="token function">mic_mask_add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint32_t <span class="token operator">*</span>arr_a<span class="token punctuation">,</span> <span class="token operator">*</span>arr_b<span class="token punctuation">,</span> <span class="token operator">*</span>arr_c<span class="token punctuation">,</span> <span class="token operator">*</span>arr_old<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    arr_a <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_b <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_c <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_old <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
        arr_b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> n <span class="token operator">+</span> i<span class="token punctuation">;</span>
        arr_old<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> offload target(mic) in(arr_a:length(n)) in(arr_b:length(n)) in(arr_old:length(n)) out(arr_c:length(n))</span>
    <span class="token punctuation">{</span>
        __m512i m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">,</span> m_c<span class="token punctuation">,</span> m_old<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 11&#x6362;&#x6210;&#x4E8C;&#x8FDB;&#x5236;&#x5C31;&#x662F;0000000000001011</span>
        __mmask16 k1 <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
        m_a <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_b <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_old <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_old<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// &#x6839;&#x636E;k1&#x7684;&#x503C;&#x53EA;&#x6709;1,2,4&#x4F4D;&#x4E3A;1 &#x6240;&#x4EE5;m_c&#x4E2D;&#x53EA;&#x6709;&#x7B2C;1,2,4&#x4E2A;&#x5143;&#x7D20;&#x4E3A;m_a &#x548C;m_b&#x4E2D;1,2,4&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x548C; &#x5269;&#x4F59;&#x5143;&#x7D20;&#x4F7F;&#x7528;arr_old&#x5BF9;&#x5E94;&#x5143;&#x7D20;&#x7684;&#x503C;</span>
        m_c <span class="token operator">=</span> <span class="token function">_mm512_mask_add_epi32</span><span class="token punctuation">(</span>m_old<span class="token punctuation">,</span> k1<span class="token punctuation">,</span> m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">,</span> m_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;arr_a[%2d] is: %2d \t  arr_b[%2d] is: %2d \t arr_old[%2d] is: %d \t  arr_c[%2d] is : %2d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr_b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr_old<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr_c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_old<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x4E3A;:</p>
<pre class="language-"><code class="lang-html">arr_a[ 0] is:  0       arr_b[ 0] is: 16      arr_old[ 0] is: 10000       arr_c[ 0] is : 16
arr_a[ 1] is:  1       arr_b[ 1] is: 17      arr_old[ 1] is: 10000       arr_c[ 1] is : 18
arr_a[ 2] is:  2       arr_b[ 2] is: 18      arr_old[ 2] is: 10000       arr_c[ 2] is : 10000
arr_a[ 3] is:  3       arr_b[ 3] is: 19      arr_old[ 3] is: 10000       arr_c[ 3] is : 22
arr_a[ 4] is:  4       arr_b[ 4] is: 20      arr_old[ 4] is: 10000       arr_c[ 4] is : 10000
arr_a[ 5] is:  5       arr_b[ 5] is: 21      arr_old[ 5] is: 10000       arr_c[ 5] is : 10000
arr_a[ 6] is:  6       arr_b[ 6] is: 22      arr_old[ 6] is: 10000       arr_c[ 6] is : 10000
arr_a[ 7] is:  7       arr_b[ 7] is: 23      arr_old[ 7] is: 10000       arr_c[ 7] is : 10000
arr_a[ 8] is:  8       arr_b[ 8] is: 24      arr_old[ 8] is: 10000       arr_c[ 8] is : 10000
arr_a[ 9] is:  9       arr_b[ 9] is: 25      arr_old[ 9] is: 10000       arr_c[ 9] is : 10000
arr_a[10] is: 10       arr_b[10] is: 26      arr_old[10] is: 10000       arr_c[10] is : 10000
arr_a[11] is: 11       arr_b[11] is: 27      arr_old[11] is: 10000       arr_c[11] is : 10000
arr_a[12] is: 12       arr_b[12] is: 28      arr_old[12] is: 10000       arr_c[12] is : 10000
arr_a[13] is: 13       arr_b[13] is: 29      arr_old[13] is: 10000       arr_c[13] is : 10000
arr_a[14] is: 14       arr_b[14] is: 30      arr_old[14] is: 10000       arr_c[14] is : 10000
arr_a[15] is: 15       arr_b[15] is: 31      arr_old[15] is: 10000       arr_c[15] is : 10000
</code></pre>
<h3 id="bitwise&#x8FD0;&#x7B97;"><a name="bitwise&#x8FD0;&#x7B97;" class="anchor-navigation-ex-anchor" href="#bitwise&#x8FD0;&#x7B97;"><i class="fa fa-link" aria-hidden="true"></i></a>Bitwise&#x8FD0;&#x7B97;</h3>
<p>MIC&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;3&#x4E2D;Bitwise&#x8FD0;&#x7B97;&#x51FD;&#x6570;- <code>and</code> <code>or</code> <code>xor</code>,  &#x5176;&#x4E2D;&#x53D6;&#x53CD;&#x5143;&#x7D20;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0E;1&#x5F02;&#x6216;&#x6765;&#x5B9E;&#x73B0;, &#x4E0B;&#x9762;&#x662F;<code>and</code>&#x64CD;&#x4F5C;&#x7684;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;</p>
<pre class="language-"><code class="lang-c"><span class="token keyword">void</span> <span class="token function">mic_and</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint32_t <span class="token operator">*</span>arr_a<span class="token punctuation">,</span> <span class="token operator">*</span>arr_b<span class="token punctuation">,</span> <span class="token operator">*</span>arr_c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    arr_a <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_b <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_c <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token punctuation">;</span>
        arr_b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> n <span class="token operator">+</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> offload target(mic) in(arr_a:length(n)) in(arr_b:length(n)) out(arr_c:length(n))</span>
    <span class="token punctuation">{</span>
        __m512i m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">,</span> m_c<span class="token punctuation">;</span>
        m_a <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_b <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_c <span class="token operator">=</span> <span class="token function">_mm512_and_epi32</span><span class="token punctuation">(</span>m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// or</span>
        <span class="token comment" spellcheck="true">// m_c = _mm512_or_epi32(m_a, m_b);</span>

        <span class="token comment" spellcheck="true">// xor</span>
        <span class="token comment" spellcheck="true">// m_c = _mm512_xor_epi32(m_a, m_b);</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">,</span> m_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        print_binary <span class="token punctuation">(</span>arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">&quot; &amp; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print_binary</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        printf <span class="token punctuation">(</span><span class="token string">&quot; = &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print_binary</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5176;&#x4E2D;<code>print_binary</code>&#x662F;&#x4E00;&#x4E2A;&#x6253;&#x5370;&#x4E8C;&#x8FDB;&#x5236;&#x7684;&#x51FD;&#x6570;, &#x8FD9;&#x91CC;&#x53EA;&#x6253;&#x5370;&#x4E86;&#x540E;8&#x4F4D;</p>
<pre class="language-"><code class="lang-c"><span class="token comment" spellcheck="true">// &#x6253;&#x5370;&#x4E8C;&#x8FDB;&#x5236;</span>
 <span class="token keyword">void</span> <span class="token function">print_binary</span><span class="token punctuation">(</span>uint64_t t<span class="token punctuation">,</span> <span class="token keyword">int</span> bit_len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">short</span> buffer<span class="token punctuation">[</span>bit_len<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        t <span class="token operator">=</span> t <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> bit_len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%hd&quot;</span><span class="token punctuation">,</span> buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x53D6;&#x53CD;&#x7684;&#x793A;&#x4F8B;</p>
<pre class="language-"><code class="lang-c"><span class="token keyword">void</span> <span class="token function">mic_not</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint32_t <span class="token operator">*</span>arr_a<span class="token punctuation">,</span> <span class="token operator">*</span>arr_c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    arr_a <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_c <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> offload target(mic) in(arr_a:length(n)) out(arr_c:length(n))</span>
    <span class="token punctuation">{</span>
        __m512i m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">,</span> m_c<span class="token punctuation">;</span>
        int32_t all_one <span class="token operator">=</span> <span class="token number">0xffffffff</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// _mm512_set1_epi32 : &#x5C06;&#x5411;&#x91CF;&#x4E2D;&#x7684;16&#x4E2A;&#x6574;&#x578B;&#x90FD;&#x8BBE;&#x4E3A;all_one</span>
        m_b <span class="token operator">=</span> <span class="token function">_mm512_set1_epi32</span><span class="token punctuation">(</span>all_one<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_a <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_c <span class="token operator">=</span> <span class="token function">_mm512_xor_epi32</span><span class="token punctuation">(</span>m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">,</span> m_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;~ &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        print_binary <span class="token punctuation">(</span>arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">&quot; = &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print_binary</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E0B;&#x9762;&#x662F;&#x8FD0;&#x884C;&#x7ED3;&#x679C;</p>
<pre class="language-"><code class="lang-html">~ 00000000 = 11111111
~ 00000001 = 11111110
~ 00000010 = 11111101
~ 00000011 = 11111100
~ 00000100 = 11111011
~ 00000101 = 11111010
~ 00000110 = 11111001
~ 00000111 = 11111000
~ 00001000 = 11110111
~ 00001001 = 11110110
~ 00001010 = 11110101
~ 00001011 = 11110100
~ 00001100 = 11110011
~ 00001101 = 11110010
~ 00001110 = 11110001
~ 00001111 = 11110000
</code></pre>
<h3 id="&#x79FB;&#x4F4D;&#x64CD;&#x4F5C;"><a name="&#x79FB;&#x4F4D;&#x64CD;&#x4F5C;" class="anchor-navigation-ex-anchor" href="#&#x79FB;&#x4F4D;&#x64CD;&#x4F5C;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x79FB;&#x4F4D;&#x64CD;&#x4F5C;</h3>
<p>&#x79FB;&#x4F4D;&#x64CD;&#x4F5C;&#x5206;&#x4E3A;&#x7B97;&#x672F;&#x79FB;&#x4F4D;&#x548C;&#x903B;&#x8F91;&#x79FB;&#x4F4D;, &#x903B;&#x8F91;&#x5DE6;&#x79FB;&#x548C;&#x7B97;&#x672F;&#x5DE6;&#x79FB;&#x7684;&#x89C4;&#x5219;&#x662F;&#x4E00;&#x6837;&#x7684;, &#x6240;&#x4EE5;&#x4E24;&#x8005;&#x5171;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x5DE6;&#x79FB;&#x51FD;&#x6570;, &#x800C;&#x903B;&#x8F91;&#x53F3;&#x79FB;&#x548C;&#x7B97;&#x672F;&#x53F3;&#x79FB;&#x4E0D;&#x540C;, &#x903B;&#x8F91;&#x53F3;&#x79FB;&#x662F;&#x4E00;&#x76F4;&#x8865;0, &#x800C;&#x7B97;&#x672F;&#x53F3;&#x79FB;&#x8981;&#x770B;&#x7B26;&#x53F7;&#x4F4D;, &#x7B26;&#x53F7;&#x4F4D;&#x4E3A;0&#x5219;&#x8865;0, &#x7B26;&#x53F7;&#x4F4D;&#x4E3A;1, &#x5219;&#x8865;1. &#x540C;&#x65F6;&#x79FB;&#x4F4D;&#x64CD;&#x4F5C;&#x6709;&#x4E24;&#x79CD;&#x5F62;&#x5F0F;, &#x4E00;&#x79CD;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x5E38;&#x6570;, &#x5411;&#x91CF;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x90FD;&#x79FB;&#x8BE5;&#x5E38;&#x6570;&#x4F4D;, &#x4E00;&#x79CD;&#x662F;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x5411;&#x91CF;, &#x5411;&#x91CF;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x79FB;&#x7ED9;&#x5B9A;&#x5411;&#x91CF;&#x4E2D;&#x5BF9;&#x5E94;&#x6570;&#x503C;&#x7684;&#x4F4D;. &#x597D;&#x5427;&#x4E0B;&#x9762;&#x8FD8;&#x662F;&#x770B;&#x4F8B;&#x5B50;&#x5427;.
<strong>&#x5DE6;&#x79FB;: &#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x5E38;&#x6570;</strong></p>
<pre class="language-"><code class="lang-c"><span class="token keyword">void</span> <span class="token function">mic_lshift</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint32_t <span class="token operator">*</span>arr_a<span class="token punctuation">,</span> <span class="token operator">*</span>arr_c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    arr_a <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_c <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> offload target(mic) in(arr_a:length(n)) out(arr_c:length(n))</span>
    <span class="token punctuation">{</span>
        __m512i m_a<span class="token punctuation">,</span> m_c<span class="token punctuation">;</span>
        m_a <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// &#x5411;&#x91CF;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x6574;&#x578B;&#x90FD;&#x5DE6;&#x79FB;&#x4E00;&#x4F4D; ,&#x903B;&#x8F91;&#x53F3;&#x79FB; _mm512_srli_epi32</span>
        m_c <span class="token operator">=</span> _mm512_slli_epi32 <span class="token punctuation">(</span>m_a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">,</span> m_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        print_binary <span class="token punctuation">(</span>arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">&quot; \t  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print_binary</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>&#x5DE6;&#x79FB;:&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x5411;&#x91CF;</strong></p>
<pre class="language-"><code class="lang-c"><span class="token keyword">void</span> <span class="token function">mic_lshift_v</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint32_t <span class="token operator">*</span>arr_a<span class="token punctuation">,</span> <span class="token operator">*</span>arr_c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    arr_a <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_c <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> offload target(mic) in(arr_a:length(n)) out(arr_c:length(n))</span>
    <span class="token punctuation">{</span>
        __m512i m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">,</span> m_c<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// _mm512_set_epi32(int e15, int e14, int e13, int e12, int e11, int e10, int e9, int e8, int e7, int e6, int e5, int e4, int e3, int e2, int e1, int e0);</span>
        <span class="token comment" spellcheck="true">// _mm512_set_epi32 &#x6309;&#x4ECE;&#x9AD8;&#x5230;&#x4F4E;&#x7684;&#x987A;&#x5E8F;, &#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x8BBE;&#x4E3A;&#x5411;&#x91CF;&#x4E2D;&#x7B2C;16&#x4E2A;&#x6574;&#x578B;&#x7684;&#x503C;, &#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x8BBE;&#x4E3A;&#x7B2C;1&#x4E2A;&#x6574;&#x578B;&#x7684;&#x503C;</span>
        m_b <span class="token operator">=</span> <span class="token function">_mm512_set_epi32</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_a <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//  &#x903B;&#x8F91;&#x53F3;&#x79FB; _mm512_srlv_epi32</span>
        m_c <span class="token operator">=</span> _mm512_sllv_epi32 <span class="token punctuation">(</span>m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">,</span> m_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        print_binary <span class="token punctuation">(</span>arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">&quot; \t  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print_binary</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6267;&#x884C;&#x7ED3;&#x679C;&#x4E3A;:</p>
<pre class="language-"><code class="lang-html">00000001       00010000
00000010       00010000
00000011       00001100
00000100       00001000
00000101       01010000
00000110       00110000
00000111       00011100
00001000       00010000
00001001       10010000
00001010       01010000
00001011       00101100
00001100       00011000
00001101       11010000
00001110       01110000
00001111       00111100
00010000       00100000
</code></pre>
<p><strong>&#x7B97;&#x672F;&#x53F3;&#x79FB;</strong></p>
<pre class="language-"><code class="lang-c"><span class="token keyword">void</span> <span class="token function">mic_arshift</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint32_t <span class="token operator">*</span>arr_a<span class="token punctuation">,</span> <span class="token operator">*</span>arr_b<span class="token punctuation">,</span> <span class="token operator">*</span>arr_c<span class="token punctuation">,</span> <span class="token operator">*</span>arr_d<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    arr_a <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_b <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_c <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_d <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    uint32_t high_one <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">31</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
        arr_b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> high_one <span class="token operator">|</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> offload target(mic) in(arr_a:length(n)) in(arr_b:length(n)) out(arr_c:length(n)) out(arr_d:length(n))</span>
    <span class="token punctuation">{</span>
        __m512i m_a<span class="token punctuation">,</span>m_b<span class="token punctuation">,</span> m_c<span class="token punctuation">,</span> m_d<span class="token punctuation">;</span>
        m_a <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//  &#x7B97;&#x672F;&#x53F3;&#x79FB;, &#x7B26;&#x53F7;&#x4E3A;0, &#x8865;0&#xFF1B;&#x7B26;&#x53F7;&#x4F4D;&#x4E3A;1, &#x8865;1</span>
        m_c <span class="token operator">=</span> _mm512_srai_epi32 <span class="token punctuation">(</span>m_a<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">,</span> m_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_b <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_d <span class="token operator">=</span> <span class="token function">_mm512_srai_epi32</span><span class="token punctuation">(</span>m_b<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_d<span class="token punctuation">,</span> m_d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;&#x7B26;&#x53F7;&#x4F4D;&#x4E3A;0: \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        print_binary <span class="token punctuation">(</span>arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">&quot; \t  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print_binary</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;&#x7B26;&#x53F7;&#x4F4D;&#x4E3A;1: \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        print_binary <span class="token punctuation">(</span>arr_b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">&quot; \t  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print_binary</span><span class="token punctuation">(</span>arr_d<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6267;&#x884C;&#x7ED3;&#x679C;&#x4E3A;:</p>
<pre class="language-"><code>&#x7B26;&#x53F7;&#x4F4D;&#x4E3A;0:
00000000000000000000000000000001       00000000000000000000000000000000
00000000000000000000000000000010       00000000000000000000000000000000
00000000000000000000000000000011       00000000000000000000000000000000
00000000000000000000000000000100       00000000000000000000000000000001
00000000000000000000000000000101       00000000000000000000000000000001
00000000000000000000000000000110       00000000000000000000000000000001
00000000000000000000000000000111       00000000000000000000000000000001
00000000000000000000000000001000       00000000000000000000000000000010
00000000000000000000000000001001       00000000000000000000000000000010
00000000000000000000000000001010       00000000000000000000000000000010
00000000000000000000000000001011       00000000000000000000000000000010
00000000000000000000000000001100       00000000000000000000000000000011
00000000000000000000000000001101       00000000000000000000000000000011
00000000000000000000000000001110       00000000000000000000000000000011
00000000000000000000000000001111       00000000000000000000000000000011
00000000000000000000000000010000       00000000000000000000000000000100
&#x7B26;&#x53F7;&#x4F4D;&#x4E3A;1:
10000000000000000000000000000001       11100000000000000000000000000000
10000000000000000000000000000010       11100000000000000000000000000000
10000000000000000000000000000011       11100000000000000000000000000000
10000000000000000000000000000100       11100000000000000000000000000001
10000000000000000000000000000101       11100000000000000000000000000001
10000000000000000000000000000110       11100000000000000000000000000001
10000000000000000000000000000111       11100000000000000000000000000001
10000000000000000000000000001000       11100000000000000000000000000010
10000000000000000000000000001001       11100000000000000000000000000010
10000000000000000000000000001010       11100000000000000000000000000010
10000000000000000000000000001011       11100000000000000000000000000010
10000000000000000000000000001100       11100000000000000000000000000011
10000000000000000000000000001101       11100000000000000000000000000011
10000000000000000000000000001110       11100000000000000000000000000011
10000000000000000000000000001111       11100000000000000000000000000011
10000000000000000000000000010000       11100000000000000000000000000100
</code></pre><h3 id="mm512alignrepi32"><a name="mm512alignrepi32" class="anchor-navigation-ex-anchor" href="#mm512alignrepi32"><i class="fa fa-link" aria-hidden="true"></i></a>_mm512_alignr_epi32</h3>
<p>&#x51FD;&#x6570;&#x539F;&#x578B;&#x4E3A;:</p>
<pre class="language-"><code class="lang-c"><span class="token keyword">extern</span> __m512i __cdecl <span class="token function">_mm512_alignr_epi32</span><span class="token punctuation">(</span>__m512i v2<span class="token punctuation">,</span> __m512i v3<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5C06;v2&#x548C;v3&#x62FC;&#x63A5;&#x8D77;&#x6765;, v2&#x5728;&#x524D;, v3&#x5728;&#x540E;, &#x7136;&#x540E;&#x5FAA;&#x73AF;&#x5DE6;&#x79FB;count&#x4E2A;&#x5143;&#x7D20;, &#x7136;&#x540E;&#x53D6;&#x6700;&#x53F3;&#x4FA7;&#x7684;16&#x4E2A;&#x5143;&#x7D20;, &#x4E0B;&#x9762;&#x770B;&#x4E2A;&#x4F8B;&#x5B50;</p>
<pre class="language-"><code class="lang-c"><span class="token keyword">void</span> <span class="token function">mic_alignr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint32_t <span class="token operator">*</span>arr_a<span class="token punctuation">,</span> <span class="token operator">*</span>arr_b<span class="token punctuation">,</span> <span class="token operator">*</span>arr_c<span class="token punctuation">,</span> <span class="token operator">*</span>arr_d<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    arr_a <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_b <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_c <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arr_d <span class="token operator">=</span> <span class="token function">_mm_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
        arr_b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> n <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> offload target(mic) in(arr_a:length(n)) in(arr_b:length(n)) out(arr_c:length(n)) out(arr_d:length(n))</span>
    <span class="token punctuation">{</span>
        __m512i m_a<span class="token punctuation">,</span>m_b<span class="token punctuation">,</span> m_c<span class="token punctuation">,</span> m_d<span class="token punctuation">;</span>
        m_a <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_b <span class="token operator">=</span> <span class="token function">_mm512_load_epi32</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//  &#x7B97;&#x672F;&#x53F3;&#x79FB;, &#x7B26;&#x53F7;&#x4E3A;0, &#x8865;0&#xFF1B;&#x7B26;&#x53F7;&#x4F4D;&#x4E3A;1, &#x8865;1</span>
        m_c <span class="token operator">=</span> _mm512_alignr_epi32 <span class="token punctuation">(</span>m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">,</span> m_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_d <span class="token operator">=</span> <span class="token function">_mm512_alignr_epi32</span><span class="token punctuation">(</span>m_a<span class="token punctuation">,</span> m_b<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_mm512_store_epi32</span><span class="token punctuation">(</span>arr_d<span class="token punctuation">,</span> m_d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;arr_a: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%2u &quot;</span><span class="token punctuation">,</span> arr_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot; \narr_b: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%2u &quot;</span><span class="token punctuation">,</span> arr_b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;count = 3  arr_c: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%2u &quot;</span><span class="token punctuation">,</span> arr_c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;count = 8  arr_c: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%2u &quot;</span><span class="token punctuation">,</span> arr_d<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_mm_free</span><span class="token punctuation">(</span>arr_d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6267;&#x884C;&#x7ED3;&#x679C;&#x4E3A;:</p>
<pre class="language-"><code class="lang-html">arr_a:  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16  
arr_b: 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32

count = 3  arr_c: 20 21 22 23 24 25 26 27 28 29 30 31 32  1  2  3
count = 8  arr_c: 25 26 27 28 29 30 31 32  1  2  3  4  5  6  7  8
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="mic-异步计算和传输.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 异步计算和传输">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"向量化","level":"1.5.7","depth":2,"previous":{"title":"异步计算和传输","level":"1.5.6","depth":2,"path":"mic-异步计算和传输.md","ref":"mic-异步计算和传输.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-highlight","prism","prism-themes","search","search-plus","simple-page-toc","baidu","sitemap","github","duoshuo","anchors","anchor-navigation-ex","expandable-chapters-small","katex","custom-favicon"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prism-themes/themes/prism-base16-ateliersulphurpool.light.css"]},"github":{"url":"https://github.com/zhangjikai/parallel"},"simple-page-toc":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"duoshuo":{"short_name":"zhangjkblog","theme":"default"},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"anchor-navigation-ex":{"isRewritePageTitle":false},"favicon":"/favicon.ico","sitemap":{"hostname":"http://parallel.zhangjikai.com"},"prism-themes":{},"custom-favicon":{},"expandable-chapters-small":{},"baidu":{"token":"ff100361cdce95dd4c8fb96b4009f7bc"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":true,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchors":{},"anchorjs":{"placement":"left"},"search-plus":{}},"theme":"default","author":"zhangjikai","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"parallel","language":"zh-hans","output.name":"site","links":{"sidebar":{"Home":"http://zhangjikai.com"}},"gitbook":"3.2.2","description":"并行计算"},"file":{"path":"mic-向量化.md","mtime":"2017-02-25T12:16:30.875Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-02-25T12:22:58.742Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-baidu/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-duoshuo/duoshuo.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

